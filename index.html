<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Venom Admin</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        :root {
            --primary: #8B5CF6;
            --primary-light: #A78BFA;
            --primary-dark: #7C3AED;
            --primary-subtle: rgba(139, 92, 246, 0.15);
            --bg-primary: #0A0A0F;
            --bg-secondary: #111118;
            --bg-card: #1A1A24;
            --bg-elevated: #222230;
            --bg-input: #2A2A38;
            --text-primary: #FFFFFF;
            --text-secondary: #A0A0B0;
            --text-tertiary: #666680;
            --border: rgba(255, 255, 255, 0.08);
            --success: #4ADE80;
            --success-bg: rgba(74, 222, 128, 0.15);
            --warning: #FBBF24;
            --warning-bg: rgba(251, 191, 36, 0.15);
            --error: #F87171;
            --error-bg: rgba(248, 113, 113, 0.15);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            -webkit-font-smoothing: antialiased;
        }

        /* Header */
        .header {
            background: var(--bg-secondary);
            padding: 14px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 50;
        }
        .header-left { display: flex; align-items: center; gap: 12px; }
        .header-logo {
            width: 36px; height: 36px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 10px;
            display: flex; align-items: center; justify-content: center;
            font-size: 18px;
        }
        .header-info h1 { font-size: 17px; font-weight: 700; }
        .header-info h1 span { color: var(--primary); }
        .header-info p { font-size: 11px; color: var(--text-tertiary); }

        /* Main */
        .main { flex: 1; overflow-y: auto; padding-bottom: 80px; }
        .page { display: none; padding: 16px; }
        .page.active { display: block; }

        /* Cards */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 14px;
            margin-bottom: 12px;
            overflow: hidden;
        }
        .card-body { padding: 16px; }
        .card-body.flush { padding: 0; }

        /* Section Headers */
        .section-title {
            font-size: 12px; font-weight: 600; color: var(--text-tertiary);
            text-transform: uppercase; letter-spacing: 0.5px;
            margin: 16px 0 8px; padding: 0 4px;
        }

        /* Status Cards Grid */
        .status-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 16px;
        }
        .status-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 12px;
            position: relative;
            overflow: hidden;
        }
        .status-card::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0;
            height: 2px; background: var(--primary);
        }
        .status-card:nth-child(2)::before { background: var(--success); }
        .status-card:nth-child(3)::before { background: var(--warning); }
        .status-label { font-size: 10px; font-weight: 600; color: var(--text-tertiary); text-transform: uppercase; letter-spacing: 0.3px; margin-bottom: 4px; }
        .status-value { font-size: 15px; font-weight: 700; }

        /* Quick Actions */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }
        .quick-action {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 14px 8px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.15s;
        }
        .quick-action:active { transform: scale(0.95); background: var(--bg-elevated); }
        .quick-action-icon {
            width: 40px; height: 40px;
            background: var(--primary-subtle);
            border-radius: 10px;
            display: flex; align-items: center; justify-content: center;
            font-size: 18px;
            margin: 0 auto 6px;
        }
        .quick-action-label { font-size: 11px; font-weight: 500; color: var(--text-secondary); }

        /* Segmented Control */
        .segmented {
            display: flex;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 3px;
            margin-bottom: 12px;
        }
        .segment {
            flex: 1; padding: 10px 8px; text-align: center;
            font-size: 13px; font-weight: 600; color: var(--text-secondary);
            background: none; border: none; border-radius: 7px; cursor: pointer;
            transition: all 0.2s;
        }
        .segment.active { background: var(--primary); color: white; }

        /* Toggle Row */
        .toggle-row {
            display: flex; align-items: center; justify-content: space-between;
            padding: 14px 16px; border-bottom: 1px solid var(--border);
        }
        .toggle-row:last-child { border-bottom: none; }
        .toggle-label { font-size: 14px; font-weight: 500; }
        .toggle-desc { font-size: 12px; color: var(--text-tertiary); margin-top: 2px; }
        .toggle {
            width: 48px; height: 28px; background: var(--bg-elevated);
            border-radius: 14px; position: relative; cursor: pointer;
            transition: background 0.2s; flex-shrink: 0;
        }
        .toggle.active { background: var(--primary); }
        .toggle::after {
            content: ''; position: absolute; top: 3px; left: 3px;
            width: 22px; height: 22px; background: white;
            border-radius: 50%; transition: transform 0.2s;
        }
        .toggle.active::after { transform: translateX(20px); }

        /* Radio Options */
        .radio-group { }
        .radio-item {
            display: flex; align-items: center; gap: 12px;
            padding: 12px 16px; border-bottom: 1px solid var(--border);
            cursor: pointer;
        }
        .radio-item:last-child { border-bottom: none; }
        .radio-item.selected { background: var(--primary-subtle); }
        .radio-dot {
            width: 20px; height: 20px; border: 2px solid var(--text-tertiary);
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            flex-shrink: 0;
        }
        .radio-item.selected .radio-dot { border-color: var(--primary); background: var(--primary); }
        .radio-dot::after {
            content: ''; width: 8px; height: 8px; background: white;
            border-radius: 50%; transform: scale(0); transition: transform 0.15s;
        }
        .radio-item.selected .radio-dot::after { transform: scale(1); }
        .radio-name { font-size: 14px; font-weight: 500; flex: 1; }
        .radio-badge {
            font-size: 11px; font-weight: 600; color: var(--text-tertiary);
            background: var(--bg-elevated); padding: 3px 8px; border-radius: 6px;
        }

        /* Range Slider */
        .range-row { padding: 14px 16px; border-bottom: 1px solid var(--border); }
        .range-row:last-child { border-bottom: none; }
        .range-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .range-label { font-size: 14px; font-weight: 500; }
        .range-value { font-size: 13px; font-weight: 600; color: var(--primary); background: var(--primary-subtle); padding: 2px 8px; border-radius: 6px; }
        input[type="range"] {
            width: 100%; height: 4px; background: var(--bg-elevated);
            border-radius: 2px; outline: none; -webkit-appearance: none; appearance: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none; width: 20px; height: 20px;
            background: var(--primary); border-radius: 50%; cursor: pointer;
            box-shadow: 0 2px 6px rgba(139, 92, 246, 0.4);
        }

        /* Textarea */
        .textarea-wrap { padding: 14px 16px; }
        .textarea {
            width: 100%; min-height: 100px; background: var(--bg-input);
            border: 1px solid var(--border); border-radius: 10px;
            padding: 12px; color: var(--text-primary);
            font-size: 13px; font-family: inherit; resize: vertical;
        }
        .textarea:focus { outline: none; border-color: var(--primary); }
        .textarea-footer { display: flex; justify-content: space-between; align-items: center; margin-top: 8px; }
        .char-count { font-size: 11px; color: var(--text-tertiary); }

        /* Info Card */
        .info-card {
            display: flex; align-items: flex-start; gap: 12px;
            padding: 14px 16px; background: var(--primary-subtle);
            border-radius: 10px; margin: 12px 0;
        }
        .info-card-icon { font-size: 18px; flex-shrink: 0; margin-top: 1px; }
        .info-card-text { font-size: 13px; color: var(--text-secondary); line-height: 1.4; }
        .info-card-text strong { color: var(--text-primary); }

        /* Text Input */
        .text-input-row { padding: 14px 16px; border-bottom: 1px solid var(--border); }
        .text-input-row:last-child { border-bottom: none; }
        .text-input-label { font-size: 14px; font-weight: 500; margin-bottom: 8px; }
        .text-input {
            width: 100%; padding: 10px 12px; background: var(--bg-input);
            border: 1px solid var(--border); border-radius: 8px;
            color: var(--text-primary); font-size: 13px; font-family: inherit;
        }
        .text-input:focus { outline: none; border-color: var(--primary); }

        /* User List */
        .user-list { padding: 0; }
        .user-item {
            display: flex; align-items: center; gap: 12px;
            padding: 12px 16px; border-bottom: 1px solid var(--border);
        }
        .user-item:last-child { border-bottom: none; }
        .user-avatar {
            width: 32px; height: 32px; background: var(--primary-subtle);
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 13px; font-weight: 600; color: var(--primary);
        }
        .user-id { font-size: 14px; font-weight: 500; flex: 1; }
        .user-remove {
            width: 28px; height: 28px; background: var(--error-bg);
            border: none; border-radius: 50%; color: var(--error);
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; font-size: 14px;
        }
        .add-user-btn {
            display: flex; align-items: center; justify-content: center; gap: 6px;
            width: 100%; padding: 12px; background: none; border: 1px dashed var(--border);
            border-radius: 10px; color: var(--primary); font-size: 13px; font-weight: 600;
            cursor: pointer; margin-top: 8px;
        }
        .add-user-btn:active { background: var(--primary-subtle); }

        /* Session Rows */
        .session-row {
            display: flex; align-items: center; gap: 12px;
            padding: 14px 16px; border-bottom: 1px solid var(--border); cursor: pointer;
        }
        .session-row:last-child { border-bottom: none; }
        .session-row:active { background: var(--bg-elevated); }
        .session-row.danger { color: var(--error); }
        .session-icon { font-size: 16px; width: 24px; text-align: center; }
        .session-label { font-size: 14px; font-weight: 500; }

        /* Apply Button */
        .apply-btn {
            display: flex; align-items: center; justify-content: center; gap: 8px;
            width: 100%; padding: 14px; margin-top: 16px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border: none; border-radius: 12px;
            font-size: 15px; font-weight: 600; color: white;
            cursor: pointer; box-shadow: 0 4px 16px rgba(139, 92, 246, 0.3);
            transition: transform 0.15s;
        }
        .apply-btn:active { transform: scale(0.98); }
        .apply-btn svg { width: 18px; height: 18px; }

        /* Bottom Nav */
        .bottom-nav {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: var(--bg-secondary);
            border-top: 1px solid var(--border);
            display: flex; padding: 6px 8px;
            padding-bottom: max(6px, env(safe-area-inset-bottom));
            z-index: 100;
        }
        .nav-item {
            flex: 1; display: flex; flex-direction: column;
            align-items: center; gap: 3px; padding: 6px 4px;
            color: var(--text-tertiary); cursor: pointer;
            background: none; border: none; position: relative;
            transition: color 0.2s;
        }
        .nav-item.active { color: var(--primary); }
        .nav-item.active::before {
            content: ''; position: absolute; top: -6px; left: 50%;
            transform: translateX(-50%); width: 20px; height: 2px;
            background: var(--primary); border-radius: 0 0 2px 2px;
        }
        .nav-item svg { width: 22px; height: 22px; }
        .nav-item span { font-size: 10px; font-weight: 600; }

        /* Bottom Sheet */
        .sheet {
            position: fixed; inset: 0; z-index: 200;
            pointer-events: none; opacity: 0; transition: opacity 0.3s;
        }
        .sheet.open { pointer-events: auto; opacity: 1; }
        .sheet-backdrop { position: absolute; inset: 0; background: rgba(0,0,0,0.6); }
        .sheet-content {
            position: absolute; bottom: 0; left: 0; right: 0;
            background: var(--bg-secondary); border-radius: 20px 20px 0 0;
            max-height: 60vh; transform: translateY(100%);
            transition: transform 0.3s; overflow: hidden;
        }
        .sheet.open .sheet-content { transform: translateY(0); }
        .sheet-handle { width: 36px; height: 4px; background: var(--text-tertiary); border-radius: 2px; margin: 10px auto; opacity: 0.4; }
        .sheet-header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 20px 12px; border-bottom: 1px solid var(--border);
        }
        .sheet-title { font-size: 17px; font-weight: 600; }
        .sheet-close {
            width: 30px; height: 30px; background: var(--bg-elevated);
            border: none; border-radius: 50%; color: var(--text-secondary);
            display: flex; align-items: center; justify-content: center; cursor: pointer;
        }
        .sheet-body { padding: 16px; overflow-y: auto; }
        .sheet-input-row { display: flex; gap: 10px; }
        .sheet-input-row .text-input { flex: 1; }
        .sheet-input-row button {
            padding: 10px 16px; background: var(--primary); border: none;
            border-radius: 8px; color: white; font-weight: 600; font-size: 13px; cursor: pointer;
        }

        /* Toast */
        .toast {
            position: fixed; bottom: 96px; left: 50%;
            transform: translateX(-50%) translateY(20px);
            background: var(--bg-elevated); color: var(--text-primary);
            padding: 10px 20px; border-radius: 20px;
            font-size: 13px; font-weight: 500;
            opacity: 0; transition: all 0.3s;
            z-index: 300; border: 1px solid var(--border);
            white-space: nowrap; max-width: 90vw; overflow: hidden; text-overflow: ellipsis;
        }
        .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
        .toast.success { background: #166534; border-color: var(--success); }
        .toast.error { background: #7f1d1d; border-color: var(--error); }

        /* Conditional visibility */
        .hidden { display: none !important; }

        /* Smooth transitions for conditional sections */
        .conditional-section { transition: opacity 0.2s; }
    </style>
</head>
<body>

<header class="header">
    <div class="header-left">
        <div class="header-logo">üêç</div>
        <div class="header-info">
            <h1><span>Venom</span> Admin</h1>
            <p>–ú–æ—Å—Ç Claude Code</p>
        </div>
    </div>
</header>

<main class="main">
    <!-- ==================== DASHBOARD ==================== -->
    <div class="page active" id="page-dashboard">
        <div class="status-grid">
            <div class="status-card">
                <div class="status-label">–†–µ–∂–∏–º</div>
                <div class="status-value" id="dash-mode">CLI</div>
            </div>
            <div class="status-card">
                <div class="status-label">–ú–æ–¥–µ–ª—å</div>
                <div class="status-value" id="dash-model">Sonnet</div>
            </div>
            <div class="status-card">
                <div class="status-label">–ü–æ—Ç–æ–∫</div>
                <div class="status-value" id="dash-stream">OFF</div>
            </div>
        </div>

        <div class="section-title">–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</div>
        <div class="quick-actions">
            <div class="quick-action" onclick="App.quickAction('/new')">
                <div class="quick-action-icon">‚ú®</div>
                <div class="quick-action-label">/new</div>
            </div>
            <div class="quick-action" onclick="App.quickAction('/status')">
                <div class="quick-action-icon">üìä</div>
                <div class="quick-action-label">/status</div>
            </div>
            <div class="quick-action" onclick="App.quickAction('/cancel')">
                <div class="quick-action-icon">üõë</div>
                <div class="quick-action-label">/cancel</div>
            </div>
            <div class="quick-action" onclick="App.quickAction('/help')">
                <div class="quick-action-icon">‚ùì</div>
                <div class="quick-action-label">/help</div>
            </div>
        </div>
    </div>

    <!-- ==================== AI MODEL ==================== -->
    <div class="page" id="page-model">
        <div class="section-title">–†–µ–∂–∏–º Claude</div>
        <div class="segmented" id="seg-mode">
            <button class="segment active" onclick="App.setMode('cli')">CLI</button>
            <button class="segment" onclick="App.setMode('sdk')">SDK</button>
            <button class="segment" onclick="App.setMode('api')">API</button>
        </div>

        <div id="section-api-model" class="conditional-section hidden">
            <div class="section-title">–ú–æ–¥–µ–ª—å API</div>
            <div class="card">
                <div class="radio-group" id="radio-api-model">
                    <div class="radio-item selected" onclick="App.setApiModel('claude-sonnet-4-20250514')">
                        <div class="radio-dot"></div>
                        <div class="radio-name">Claude Sonnet 4</div>
                        <span class="radio-badge">–ë–∞–ª–∞–Ω—Å</span>
                    </div>
                    <div class="radio-item" onclick="App.setApiModel('claude-opus-4-20250514')">
                        <div class="radio-dot"></div>
                        <div class="radio-name">Claude Opus 4</div>
                        <span class="radio-badge">–ü—Ä–µ–º–∏—É–º</span>
                    </div>
                    <div class="radio-item" onclick="App.setApiModel('claude-3-5-haiku-20241022')">
                        <div class="radio-dot"></div>
                        <div class="radio-name">Claude Haiku 3.5</div>
                        <span class="radio-badge">–ë—ã—Å—Ç—Ä—ã–π</span>
                    </div>
                </div>
            </div>
        </div>

        <div id="section-cli-timeout" class="conditional-section hidden">
            <div class="section-title">–¢–∞–π–º–∞—É—Ç CLI</div>
            <div class="card">
                <div class="range-row">
                    <div class="range-header">
                        <span class="range-label">–¢–∞–π–º–∞—É—Ç</span>
                        <span class="range-value" id="val-timeout">300s</span>
                    </div>
                    <input type="range" min="60" max="1800" step="30" value="300" id="range-timeout" oninput="App.updateTimeout(this.value)">
                </div>
            </div>
        </div>

        <div id="section-max-tokens" class="conditional-section hidden">
            <div class="section-title">–ú–∞–∫—Å. —Ç–æ–∫–µ–Ω—ã</div>
            <div class="card">
                <div class="range-row">
                    <div class="range-header">
                        <span class="range-label">–ú–∞–∫—Å. —Ç–æ–∫–µ–Ω—ã</span>
                        <span class="range-value" id="val-tokens">8192</span>
                    </div>
                    <input type="range" min="1024" max="32768" step="1024" value="8192" id="range-tokens" oninput="App.updateTokens(this.value)">
                </div>
            </div>
        </div>

        <div class="section-title">–°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç</div>
        <div class="card">
            <div class="textarea-wrap">
                <textarea class="textarea" id="system-prompt" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç..." oninput="App.updateCharCount()"></textarea>
                <div class="textarea-footer">
                    <span class="char-count" id="char-count">0 / 4000</span>
                </div>
            </div>
        </div>

        <button class="apply-btn" onclick="App.applyModel()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 2L11 13"/><path d="M22 2l-7 20-4-9-9-4 20-7z"/></svg>
            –ü—Ä–∏–º–µ–Ω–∏—Ç—å
        </button>
    </div>

    <!-- ==================== VOICE ==================== -->
    <div class="page" id="page-voice">
        <div class="section-title">–û–∑–≤—É—á–∫–∞ —Ç–µ–∫—Å—Ç–∞</div>
        <div class="card">
            <div class="toggle-row">
                <div>
                    <div class="toggle-label">TTS –≤–∫–ª—é—á—ë–Ω</div>
                    <div class="toggle-desc">–û–∑–≤—É—á–∏–≤–∞—Ç—å –æ—Ç–≤–µ—Ç—ã</div>
                </div>
                <div class="toggle" id="toggle-tts" onclick="App.toggleTTS()"></div>
            </div>
        </div>

        <div id="section-tts-voice" class="conditional-section">
            <div class="section-title">–ì–æ–ª–æ—Å TTS</div>
            <div class="card">
                <div class="radio-group" id="radio-tts-voice">
                    <div class="radio-item selected" onclick="App.setTTSVoice('ru-RU-DmitryNeural')">
                        <div class="radio-dot"></div>
                        <div class="radio-name">–î–º–∏—Ç—Ä–∏–π</div>
                        <span class="radio-badge">–ú—É–∂.</span>
                    </div>
                    <div class="radio-item" onclick="App.setTTSVoice('ru-RU-SvetlanaNeural')">
                        <div class="radio-dot"></div>
                        <div class="radio-name">–°–≤–µ—Ç–ª–∞–Ω–∞</div>
                        <span class="radio-badge">–ñ–µ–Ω.</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="section-title">–†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏</div>
        <div class="info-card">
            <div class="info-card-icon">üé§</div>
            <div class="info-card-text">
                <strong>Deepgram Nova-2</strong><br>
                –Ø–∑—ã–∫: –†—É—Å—Å–∫–∏–π (ru)<br>
                –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
            </div>
        </div>

        <button class="apply-btn" onclick="App.applyVoice()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 2L11 13"/><path d="M22 2l-7 20-4-9-9-4 20-7z"/></svg>
            –ü—Ä–∏–º–µ–Ω–∏—Ç—å
        </button>
    </div>

    <!-- ==================== ALERTS ==================== -->
    <div class="page" id="page-alerts">
        <div class="section-title">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</div>
        <div class="card">
            <div class="toggle-row">
                <div>
                    <div class="toggle-label">–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è</div>
                    <div class="toggle-desc">–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è</div>
                </div>
                <div class="toggle" id="toggle-reminders" onclick="App.toggle('remindersEnabled')"></div>
            </div>
            <div class="toggle-row">
                <div>
                    <div class="toggle-label">–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</div>
                    <div class="toggle-desc">–ö–∞—Ä—Ç–∏–Ω–∫–∏ –¥–ª—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π</div>
                </div>
                <div class="toggle" id="toggle-images" onclick="App.toggle('imageGenEnabled')"></div>
            </div>
            <div class="toggle-row">
                <div>
                    <div class="toggle-label">–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–∞–¥–∞—á</div>
                    <div class="toggle-desc">–£–≤–µ–¥–æ–º–ª—è—Ç—å –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∑–∞–¥–∞—á</div>
                </div>
                <div class="toggle" id="toggle-task-alerts" onclick="App.toggle('taskAlerts')"></div>
            </div>
            <div class="toggle-row">
                <div>
                    <div class="toggle-label">–û—à–∏–±–∫–∏</div>
                    <div class="toggle-desc">–£–≤–µ–¥–æ–º–ª—è—Ç—å –æ–± –æ—à–∏–±–∫–∞—Ö</div>
                </div>
                <div class="toggle" id="toggle-error-alerts" onclick="App.toggle('errorAlerts')"></div>
            </div>
        </div>

        <button class="apply-btn" onclick="App.applyAlerts()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 2L11 13"/><path d="M22 2l-7 20-4-9-9-4 20-7z"/></svg>
            –ü—Ä–∏–º–µ–Ω–∏—Ç—å
        </button>
    </div>

    <!-- ==================== GENERAL ==================== -->
    <div class="page" id="page-general">
        <div class="section-title">–†–µ–∂–∏–º —Å—Ç—Ä–∏–º–∏–Ω–≥–∞</div>
        <div class="segmented" id="seg-stream">
            <button class="segment active" onclick="App.setStream('off')">–í–´–ö–õ</button>
            <button class="segment" onclick="App.setStream('partial')">–ß–∞—Å—Ç–∏—á–Ω—ã–π</button>
            <button class="segment" onclick="App.setStream('full')">–ü–æ–ª–Ω—ã–π</button>
        </div>

        <div class="section-title">Git</div>
        <div class="card">
            <div class="toggle-row">
                <div>
                    <div class="toggle-label">Git –≤–∫–ª—é—á—ë–Ω</div>
                    <div class="toggle-desc">–í–∫–ª—é—á–∏—Ç—å git-–æ–ø–µ—Ä–∞—Ü–∏–∏</div>
                </div>
                <div class="toggle" id="toggle-git" onclick="App.toggle('gitEnabled')"></div>
            </div>
            <div id="section-git-opts" class="conditional-section">
                <div class="toggle-row">
                    <div>
                        <div class="toggle-label">–ê–≤—Ç–æ-–∫–æ–º–º–∏—Ç</div>
                        <div class="toggle-desc">–ö–æ–º–º–∏—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</div>
                    </div>
                    <div class="toggle" id="toggle-autocommit" onclick="App.toggle('gitAutoCommit')"></div>
                </div>
                <div class="text-input-row">
                    <div class="text-input-label">–ü—Ä–µ—Ñ–∏–∫—Å –≤–µ—Ç–∫–∏</div>
                    <input type="text" class="text-input" id="input-branch-prefix" placeholder="venom/" value="venom/" oninput="App.setBranchPrefix(this.value)">
                </div>
            </div>
        </div>

        <div class="section-title">–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ</div>
        <div class="segmented" id="seg-log">
            <button class="segment" onclick="App.setLogLevel('debug')">Debug</button>
            <button class="segment active" onclick="App.setLogLevel('info')">Info</button>
            <button class="segment" onclick="App.setLogLevel('warn')">Warn</button>
            <button class="segment" onclick="App.setLogLevel('error')">Error</button>
        </div>

        <div class="section-title">–†–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</div>
        <div class="card">
            <div id="user-list" class="user-list"></div>
        </div>
        <button class="add-user-btn" onclick="App.openAddUser()">+ –î–æ–±–∞–≤–∏—Ç—å</button>

        <div class="section-title">–°–µ—Å—Å–∏—è</div>
        <div class="card">
            <div class="session-row" onclick="App.resetSession()">
                <span class="session-icon">üîÑ</span>
                <span class="session-label">–°–±—Ä–æ—Å–∏—Ç—å —Å–µ—Å—Å–∏—é</span>
            </div>
            <div class="session-row" onclick="App.clearData()">
                <span class="session-icon">üóë</span>
                <span class="session-label">–û—á–∏—Å—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</span>
            </div>
            <div class="session-row" onclick="App.exportSettings()">
                <span class="session-icon">üì¶</span>
                <span class="session-label">–≠–∫—Å–ø–æ—Ä—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫</span>
            </div>
        </div>

        <button class="apply-btn" onclick="App.applyGeneral()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 2L11 13"/><path d="M22 2l-7 20-4-9-9-4 20-7z"/></svg>
            –ü—Ä–∏–º–µ–Ω–∏—Ç—å
        </button>
    </div>
</main>

<!-- Bottom Nav -->
<nav class="bottom-nav">
    <button class="nav-item active" data-page="dashboard" onclick="Nav.go('dashboard')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="7" height="9" rx="1"/><rect x="14" y="3" width="7" height="5" rx="1"/>
            <rect x="14" y="12" width="7" height="9" rx="1"/><rect x="3" y="16" width="7" height="5" rx="1"/>
        </svg>
        <span>–û–±–∑–æ—Ä</span>
    </button>
    <button class="nav-item" data-page="model" onclick="Nav.go('model')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a2 2 0 0 1-2 2h-4a2 2 0 0 1-2-2v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7z"/>
            <path d="M9 22h6"/><path d="M10 22v-1"/><path d="M14 22v-1"/>
        </svg>
        <span>–ú–æ–¥–µ–ª—å</span>
    </button>
    <button class="nav-item" data-page="voice" onclick="Nav.go('voice')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/>
            <path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/>
            <line x1="8" y1="23" x2="16" y2="23"/>
        </svg>
        <span>–ì–æ–ª–æ—Å</span>
    </button>
    <button class="nav-item" data-page="alerts" onclick="Nav.go('alerts')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
            <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
        </svg>
        <span>–û–ø–æ–≤–µ—â–µ–Ω–∏—è</span>
    </button>
    <button class="nav-item" data-page="general" onclick="Nav.go('general')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="3"/>
            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/>
        </svg>
        <span>–û–±—â–µ–µ</span>
    </button>
</nav>

<!-- Add User Sheet -->
<div class="sheet" id="sheet-add-user">
    <div class="sheet-backdrop" onclick="App.closeSheet()"></div>
    <div class="sheet-content">
        <div class="sheet-handle"></div>
        <div class="sheet-header">
            <div class="sheet-title">–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</div>
            <button class="sheet-close" onclick="App.closeSheet()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>
            </button>
        </div>
        <div class="sheet-body">
            <div class="sheet-input-row">
                <input type="text" class="text-input" id="input-new-user" placeholder="ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram" inputmode="numeric">
                <button onclick="App.addUser()">–î–æ–±–∞–≤–∏—Ç—å</button>
            </div>
        </div>
    </div>
</div>

<div class="toast" id="toast"></div>

<script>
const tg = window.Telegram?.WebApp;
tg?.expand();
tg?.ready();

/* ============ STATE ============ */
const STORAGE_KEY = 'venom_settings_v1';

const DEFAULTS = {
    claudeMode: 'cli',
    apiModel: 'claude-sonnet-4-20250514',
    cliTimeout: 300,
    apiMaxTokens: 8192,
    systemPrompt: '',
    ttsEnabled: false,
    ttsVoice: 'ru-RU-DmitryNeural',
    remindersEnabled: true,
    imageGenEnabled: true,
    taskAlerts: true,
    errorAlerts: true,
    streamMode: 'off',
    gitEnabled: true,
    gitAutoCommit: false,
    gitBranchPrefix: 'venom/',
    logLevel: 'info',
    allowedUsers: []
};

const State = {
    data: {},

    load() {
        try {
            const s = localStorage.getItem(STORAGE_KEY);
            this.data = s ? { ...DEFAULTS, ...JSON.parse(s) } : { ...DEFAULTS };
        } catch (e) {
            this.data = { ...DEFAULTS };
        }
        this.syncFromCloud();
    },

    save() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(this.data));
    },

    get(k) { return this.data[k]; },

    set(k, v) {
        this.data[k] = v;
        this.save();
        this.syncToCloud(k, v);
    },

    syncToCloud(key, value) {
        if (tg?.CloudStorage) {
            const v = typeof value === 'object' ? JSON.stringify(value) : String(value);
            tg.CloudStorage.setItem('venom_' + key, v);
        }
    },

    syncFromCloud() {
        if (!tg?.CloudStorage) return;
        const keys = Object.keys(DEFAULTS).map(k => 'venom_' + k);
        tg.CloudStorage.getItems(keys, (err, values) => {
            if (err || !values) return;
            for (const k of Object.keys(DEFAULTS)) {
                const raw = values['venom_' + k];
                if (raw === undefined || raw === null || raw === '') continue;
                const def = DEFAULTS[k];
                if (typeof def === 'boolean') this.data[k] = raw === 'true';
                else if (typeof def === 'number') this.data[k] = Number(raw);
                else if (Array.isArray(def)) { try { this.data[k] = JSON.parse(raw); } catch(e) {} }
                else this.data[k] = raw;
            }
            this.save();
            App.renderAll();
        });
    }
};

/* ============ HELPERS ============ */
const Toast = {
    show(msg, type = '') {
        const el = document.getElementById('toast');
        el.textContent = msg;
        el.className = 'toast ' + type;
        setTimeout(() => el.classList.add('show'), 10);
        setTimeout(() => el.classList.remove('show'), 2500);
    }
};

const Haptic = {
    light() { tg?.HapticFeedback?.impactOccurred('light'); },
    medium() { tg?.HapticFeedback?.impactOccurred('medium'); },
    success() { tg?.HapticFeedback?.notificationOccurred('success'); },
    error() { tg?.HapticFeedback?.notificationOccurred('error'); }
};

function sendCommand(cmd) {
    if (tg?.sendData) {
        tg.sendData(cmd);
    } else {
        navigator.clipboard.writeText(cmd).then(() => {
            Toast.show('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ: ' + cmd, 'success');
        }).catch(() => {
            Toast.show(cmd);
        });
    }
}

/* ============ NAV ============ */
const Nav = {
    current: 'dashboard',
    go(page) {
        if (this.current === page) return;
        Haptic.light();
        this.current = page;
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById('page-' + page).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.querySelector('[data-page="' + page + '"]').classList.add('active');
    }
};

/* ============ APP ============ */
const App = {
    init() {
        State.load();
        this.renderAll();
    },

    renderAll() {
        this.renderDashboard();
        this.renderModelPage();
        this.renderVoicePage();
        this.renderAlertsPage();
        this.renderGeneralPage();
    },

    /* --- Dashboard --- */
    renderDashboard() {
        const mode = State.get('claudeMode').toUpperCase();
        document.getElementById('dash-mode').textContent = mode;

        const modelMap = {
            'claude-sonnet-4-20250514': 'Sonnet 4',
            'claude-opus-4-20250514': 'Opus 4',
            'claude-3-5-haiku-20241022': 'Haiku 3.5'
        };
        document.getElementById('dash-model').textContent =
            State.get('claudeMode') === 'api' ? (modelMap[State.get('apiModel')] || 'Sonnet') : '‚Äî';

        const streamMap = { off: '–í–´–ö–õ', partial: '–ß–∞—Å—Ç–∏—á–Ω—ã–π', full: '–ü–æ–ª–Ω—ã–π' };
        document.getElementById('dash-stream').textContent = streamMap[State.get('streamMode')] || 'OFF';
    },

    quickAction(cmd) {
        Haptic.medium();
        sendCommand(cmd);
    },

    /* --- AI Model Page --- */
    renderModelPage() {
        const mode = State.get('claudeMode');
        this.renderSegmented('seg-mode', mode, ['cli', 'sdk', 'api']);

        // Conditional sections
        document.getElementById('section-api-model').classList.toggle('hidden', mode !== 'api');
        document.getElementById('section-cli-timeout').classList.toggle('hidden', mode !== 'cli');
        document.getElementById('section-max-tokens').classList.toggle('hidden', mode !== 'api');

        // API model radios
        this.renderRadioGroup('radio-api-model', State.get('apiModel'), [
            { value: 'claude-sonnet-4-20250514', name: 'Claude Sonnet 4', badge: '–ë–∞–ª–∞–Ω—Å' },
            { value: 'claude-opus-4-20250514', name: 'Claude Opus 4', badge: '–ü—Ä–µ–º–∏—É–º' },
            { value: 'claude-3-5-haiku-20241022', name: 'Claude Haiku 3.5', badge: '–ë—ã—Å—Ç—Ä—ã–π' }
        ], v => App.setApiModel(v));

        // Sliders
        document.getElementById('range-timeout').value = State.get('cliTimeout');
        document.getElementById('val-timeout').textContent = State.get('cliTimeout') + 's';
        document.getElementById('range-tokens').value = State.get('apiMaxTokens');
        document.getElementById('val-tokens').textContent = State.get('apiMaxTokens');

        // Prompt
        document.getElementById('system-prompt').value = State.get('systemPrompt') || '';
        this.updateCharCount();
    },

    setMode(m) {
        Haptic.light();
        State.set('claudeMode', m);
        this.renderModelPage();
        this.renderDashboard();
    },

    setApiModel(m) {
        Haptic.light();
        State.set('apiModel', m);
        this.renderModelPage();
        this.renderDashboard();
    },

    updateTimeout(v) {
        State.set('cliTimeout', Number(v));
        document.getElementById('val-timeout').textContent = v + 's';
    },

    updateTokens(v) {
        State.set('apiMaxTokens', Number(v));
        document.getElementById('val-tokens').textContent = v;
    },

    updateCharCount() {
        const el = document.getElementById('system-prompt');
        document.getElementById('char-count').textContent = el.value.length + ' / 4000';
    },

    applyModel() {
        Haptic.medium();
        const mode = State.get('claudeMode');
        const parts = ['/config set claude.mode=' + mode];

        if (mode === 'api') {
            parts.push('claude.api.model=' + State.get('apiModel'));
            parts.push('claude.api.maxTokens=' + State.get('apiMaxTokens'));
        }
        if (mode === 'cli') {
            parts.push('claude.cli.timeout=' + State.get('cliTimeout'));
        }

        const prompt = document.getElementById('system-prompt').value;
        if (prompt !== (State.get('systemPrompt') || '')) {
            State.set('systemPrompt', prompt);
        }
        if (prompt) {
            parts.push('claude.systemPrompt="' + prompt.replace(/"/g, '\\"') + '"');
        }

        sendCommand(parts.join(' '));
    },

    /* --- Voice Page --- */
    renderVoicePage() {
        this.renderToggle('toggle-tts', State.get('ttsEnabled'));
        document.getElementById('section-tts-voice').classList.toggle('hidden', !State.get('ttsEnabled'));
        this.renderRadioGroup('radio-tts-voice', State.get('ttsVoice'), [
            { value: 'ru-RU-DmitryNeural', name: '–î–º–∏—Ç—Ä–∏–π', badge: '–ú—É–∂.' },
            { value: 'ru-RU-SvetlanaNeural', name: '–°–≤–µ—Ç–ª–∞–Ω–∞', badge: '–ñ–µ–Ω.' }
        ], v => App.setTTSVoice(v));
    },

    toggleTTS() {
        Haptic.light();
        State.set('ttsEnabled', !State.get('ttsEnabled'));
        this.renderVoicePage();
    },

    setTTSVoice(v) {
        Haptic.light();
        State.set('ttsVoice', v);
        this.renderVoicePage();
    },

    applyVoice() {
        Haptic.medium();
        const parts = ['/config set tts.enabled=' + State.get('ttsEnabled')];
        if (State.get('ttsEnabled')) {
            parts.push('tts.voice=' + State.get('ttsVoice'));
        }
        sendCommand(parts.join(' '));
    },

    /* --- Alerts Page --- */
    renderAlertsPage() {
        this.renderToggle('toggle-reminders', State.get('remindersEnabled'));
        this.renderToggle('toggle-images', State.get('imageGenEnabled'));
        this.renderToggle('toggle-task-alerts', State.get('taskAlerts'));
        this.renderToggle('toggle-error-alerts', State.get('errorAlerts'));
    },

    applyAlerts() {
        Haptic.medium();
        const parts = [
            '/config set reminders.enabled=' + State.get('remindersEnabled'),
            'reminders.imageGen=' + State.get('imageGenEnabled'),
            'alerts.taskCompletion=' + State.get('taskAlerts'),
            'alerts.errors=' + State.get('errorAlerts')
        ];
        sendCommand(parts.join(' '));
    },

    /* --- General Page --- */
    renderGeneralPage() {
        this.renderSegmented('seg-stream', State.get('streamMode'), ['off', 'partial', 'full']);
        this.renderToggle('toggle-git', State.get('gitEnabled'));

        const gitOpts = document.getElementById('section-git-opts');
        if (State.get('gitEnabled')) {
            gitOpts.classList.remove('hidden');
            this.renderToggle('toggle-autocommit', State.get('gitAutoCommit'));
            document.getElementById('input-branch-prefix').value = State.get('gitBranchPrefix') || 'venom/';
        } else {
            gitOpts.classList.add('hidden');
        }

        this.renderSegmented('seg-log', State.get('logLevel'), ['debug', 'info', 'warn', 'error']);
        this.renderUserList();
    },

    setStream(v) {
        Haptic.light();
        State.set('streamMode', v);
        this.renderGeneralPage();
        this.renderDashboard();
    },

    setLogLevel(v) {
        Haptic.light();
        State.set('logLevel', v);
        this.renderGeneralPage();
    },

    setBranchPrefix(v) {
        State.set('gitBranchPrefix', v);
    },

    toggle(key) {
        Haptic.light();
        State.set(key, !State.get(key));
        this.renderAlertsPage();
        this.renderGeneralPage();
    },

    renderUserList() {
        const users = State.get('allowedUsers') || [];
        const el = document.getElementById('user-list');
        if (!users.length) {
            el.innerHTML = '<div style="padding:16px;text-align:center;color:var(--text-tertiary);font-size:13px">–ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>';
            return;
        }
        el.innerHTML = users.map((id, i) =>
            '<div class="user-item">' +
            '<div class="user-avatar">' + String(id).slice(-2) + '</div>' +
            '<div class="user-id">' + id + '</div>' +
            '<button class="user-remove" onclick="App.removeUser(' + i + ')">‚úï</button>' +
            '</div>'
        ).join('');
    },

    openAddUser() {
        Haptic.light();
        document.getElementById('sheet-add-user').classList.add('open');
        tg?.BackButton?.show();
    },

    closeSheet() {
        document.getElementById('sheet-add-user').classList.remove('open');
        document.getElementById('input-new-user').value = '';
        tg?.BackButton?.hide();
    },

    addUser() {
        const input = document.getElementById('input-new-user');
        const val = input.value.trim();
        if (!val) return;
        Haptic.success();
        const users = [...(State.get('allowedUsers') || [])];
        if (!users.includes(val)) {
            users.push(val);
            State.set('allowedUsers', users);
        }
        this.closeSheet();
        this.renderUserList();
        Toast.show('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–±–∞–≤–ª–µ–Ω', 'success');
    },

    removeUser(index) {
        Haptic.light();
        const users = [...(State.get('allowedUsers') || [])];
        users.splice(index, 1);
        State.set('allowedUsers', users);
        this.renderUserList();
    },

    resetSession() {
        Haptic.medium();
        sendCommand('/new');
        Toast.show('–°–µ—Å—Å–∏—è —Å–±—Ä–æ—à–µ–Ω–∞');
    },

    clearData() {
        Haptic.medium();
        localStorage.removeItem(STORAGE_KEY);
        if (tg?.CloudStorage) {
            Object.keys(DEFAULTS).forEach(k => tg.CloudStorage.removeItem('venom_' + k));
        }
        State.data = { ...DEFAULTS };
        State.save();
        this.renderAll();
        Toast.show('–î–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã', 'success');
    },

    exportSettings() {
        Haptic.medium();
        const json = JSON.stringify(State.data, null, 2);
        navigator.clipboard.writeText(json).then(() => {
            Toast.show('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã', 'success');
        }).catch(() => {
            Toast.show('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞', 'error');
        });
    },

    applyGeneral() {
        Haptic.medium();
        const parts = [
            '/config set telegram.streamMode=' + State.get('streamMode'),
            'git.enabled=' + State.get('gitEnabled')
        ];
        if (State.get('gitEnabled')) {
            parts.push('git.autoCommit=' + State.get('gitAutoCommit'));
            parts.push('git.branchPrefix=' + State.get('gitBranchPrefix'));
        }
        parts.push('logging.level=' + State.get('logLevel'));

        const users = State.get('allowedUsers') || [];
        if (users.length) {
            parts.push('telegram.allowedUsers=' + users.join(','));
        }

        sendCommand(parts.join(' '));
    },

    /* --- Shared Renderers --- */
    renderSegmented(containerId, active, values) {
        const btns = document.getElementById(containerId).querySelectorAll('.segment');
        btns.forEach((btn, i) => {
            btn.classList.toggle('active', values[i] === active);
        });
    },

    renderToggle(id, value) {
        const el = document.getElementById(id);
        if (el) el.classList.toggle('active', !!value);
    },

    renderRadioGroup(containerId, selected, options, onClick) {
        const container = document.getElementById(containerId);
        if (!container) return;
        container.innerHTML = options.map(opt =>
            '<div class="radio-item' + (opt.value === selected ? ' selected' : '') + '" onclick="(' + onClick + ')(\'' + opt.value + '\')">' +
            '<div class="radio-dot"></div>' +
            '<div class="radio-name">' + opt.name + '</div>' +
            '<span class="radio-badge">' + opt.badge + '</span>' +
            '</div>'
        ).join('');
    }
};

tg?.BackButton?.onClick(() => App.closeSheet());

App.init();
</script>
</body>
</html>
